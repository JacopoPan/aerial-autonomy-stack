<% drone_type = ENV.fetch('DRONE_TYPE', 'quad') %>
<% autopilot = ENV.fetch('AUTOPILOT', 'px4') %>
<% drone_id = ENV.fetch('DRONE_ID', 1).to_i %>

name: aircraft_tmuxinator

windows:

  <% if autopilot == 'px4' %>
  - px4_aircraft_<%= drone_id %>:
      layout: even-horizontal
      panes:
        - MicroXRCEAgent udp4 -p 8888

  <% elsif autopilot == 'ardupilot' %>
  - ardupilot_aircraft_<%= drone_id %>:
      layout: even-horizontal
      panes:
        - /git/MAVSDK/build/src/mavsdk_server/src/mavsdk_server udpin://0.0.0.0:14550
  <% end %>

  - yolo:
      layout: even-horizontal
      panes:
        - python3 /git/resources/yolo/yolo-inference.py

  - serial_over_tcp:
      layout: even-horizontal
      panes:
        - >
          socat PTY,link=/dev/tty_drone_mcat,raw,echo=0,wait-slave TCP:42.42.1.99:54321 & 
          sleep <%= 3 + drone_id %> && echo 'message from aircraft <%= drone_id %>' > /dev/tty_drone_mcat
        - sleep 2 && cat /dev/tty_drone_mcat

  - housekeeping:
      layout: even-horizontal
      panes:
        - # Interactive pane
        - htop
